---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import SessionCard from '../../components/SessionCard.astro';
import { sortSessions, isUpcoming } from '../../lib/sessions';

const settings = (await getCollection('settings_en'))[0].data;
const sessions = sortSessions(await getCollection('sessions_en'));
const upcoming = sessions.filter(isUpcoming).slice(0, 3);
---
<BaseLayout lang="en" pageTitle={settings.title} nav={settings.nav} currentPath="home" languageLabel="English | 中文" languageUrl="/cn">
  <section class="hero card">
    <img src={settings.hero_image} alt="Hero" />
    <div>
      <h1>{settings.title}</h1>
      <p>{settings.subtitle}</p>
      <a class="button" href="/en/sessions">{settings.hero_cta}</a>
    </div>
  </section>

  <section class="grid-two">
    <article class="card">
      <h2>Purpose</h2>
      <p>{settings.purpose.paragraph}</p>
      <ul>{settings.purpose.bullets.map((b) => <li>{b}</li>)}</ul>
    </article>
    <article class="card">
      <h2>How it works</h2>
      <ul>{settings.how_it_works.map((item) => <li>{item}</li>)}</ul>
    </article>
  </section>

  <section>
    <h2>Themes</h2>
    <div class="grid-four">
      {settings.themes.map((theme) => (
        <article class="card"><h3>{theme.title}</h3><p>{theme.description}</p></article>
      ))}
    </div>
  </section>

  <section>
    <h2>Upcoming Sessions</h2>
    <div class="stack">
      {upcoming.map((session) => <SessionCard session={session} labels={{ open: 'Open', closed: 'Closed', register: 'Register', closedCta: 'Registration closed' }} />)}
    </div>
  </section>

  <section class="card">
    <h2>Organisers</h2>
    <ul>{settings.organisers.map((p) => <li>{p.name} — {p.role}{p.email ? ` (${p.email})` : ''}</li>)}</ul>
    <p><strong>{settings.registration_note}</strong></p>
  </section>

  {settings.gallery_images?.length ? (
    <section>
      <h2>Gallery</h2>
      <div class="gallery">
        {settings.gallery_images.map((img) => <img src={img} alt="Gallery image" class="card" />)}
      </div>
    </section>
  ) : null}
</BaseLayout>

<style>
  section { margin-bottom: 26px; }
  .hero { display: grid; gap: 16px; grid-template-columns: 1.2fr 1fr; align-items: center; }
  .hero img { width: 100%; border-radius: 12px; min-height: 220px; object-fit: cover; }
  .grid-two { display: grid; gap: 16px; grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .grid-four { display: grid; gap: 14px; grid-template-columns: repeat(4, minmax(0, 1fr)); }
  .stack { display: grid; gap: 14px; }
  .gallery { display: grid; gap: 12px; grid-template-columns: repeat(3, 1fr); }
  .gallery img { width: 100%; object-fit: cover; height: 140px; }
  @media (max-width: 860px) {
    .hero, .grid-two, .grid-four, .gallery { grid-template-columns: 1fr; }
  }
</style>
